<?php

$user = Yii::$app->user->identity;
echo "<div class=\"easyui-layout\">\n    <div data-options=\"region:'north',border:false\" style=\"height:130px;padding: 10px\">\n        <div class=\"easyui-layout\">\n            <div data-options=\"region:'west',border:false\" style=\"width:50%\">\n                <div class=\"easyui-layout\">\n                    <div data-options=\"region:'west',border:false\" style=\"width:50%\">\n                        <div class=\"form-control\">\n                            <input id=\"kode_order\" disabled class=\"easyui-textbox\" label=\"Kode Order:\" data-options=\"\"\n                                   style=\"width:250px\">\n                        </div>\n                        <div class=\"form-control\">\n                            <input id=\"no_po\" disabled class=\"easyui-textbox\" label=\"No PO:\" data-options=\"\"\n                                   style=\"width:250px\">\n                        </div>\n                        <div class=\"form-control\">\n                            <input id=\"tanggal_po\" disabled class=\"easyui-datebox\" label=\"Tgl. PO:\" data-options=\"\"\n                                   style=\"width:200px\">\n                        </div>\n                    </div>\n                    <div data-options=\"region:'east',border:false\" style=\"width:50%\">\n                        <div class=\"form-control\">\n                            ";
echo yii\helpers\Html::dropDownList("tipe_po", NULL, yii\helpers\ArrayHelper::map(app\models\PurchaseOrderTipe::find()->all(), "id", "nama"), array("class" => "easyui-combobox", "id" => "tipe_po", "label" => "Tipe PO:", "style" => "width:250px", "disabled" => true));
echo "                        </div>\n                        <div class=\"form-control\">\n                            ";
echo yii\helpers\Html::dropDownList("supplier", NULL, yii\helpers\ArrayHelper::map(app\models\Supplier::find()->where(array("jaringan_id" => app\models\Jaringan::getCurrentID()))->all(), "id", "nama"), array("class" => "easyui-combobox", "id" => "supplier", "label" => "Supplier:", "style" => "width:250px", "prompt" => "(Pilih)", "disabled" => true));
echo "\n                            <button id=\"btn_search_supplier\" disabled class=\"easyui-linkbutton\"\n                                    data-options=\"iconCls:'icon-search'\"></button>\n                        </div>\n                        <div class=\"form-control\">\n                            ";
echo yii\helpers\Html::dropDownList("status_po", NULL, yii\helpers\ArrayHelper::map(app\models\PurchaseOrderStatus::find()->all(), "id", "nama"), array("class" => "easyui-combobox", "id" => "status_po", "label" => "Status PO:", "style" => "width:250px", "disabled" => true));
echo "                        </div>\n                    </div>\n                </div>\n            </div>\n            <div data-options=\"region:'east',border:false\" style=\"width:50%\">\n                <table id=\"list_purchase_order\" style=\"width:100%;height:100%\">\n                    <thead>\n                    <tr>\n                        <th field=\"kode\" width=\"100\">Kode Order</th>\n                        <th field=\"nomor\" width=\"150\">No PO</th>\n                        <th field=\"tanggal_pembuatan\" width=\"80\">Tanggal</th>\n                        <th field=\"supplier_nama\" width=\"150\">Supplier</th>\n                        <th field=\"purchase_order_status_nama\" width=\"80\">Status</th>\n                    </tr>\n                    </thead>\n                </table>\n            </div>\n        </div>\n    </div>\n    <div data-options=\"region:'center',border:false\" style=\"padding: 0px 10px 10px\">\n        <table id=\"list_suku_cadang\" style=\"width:100%;height:100%\">\n            <thead>\n            <tr>\n                <th field=\"kode\" width=\"100\">Kode Part</th>\n                <th field=\"nama\" width=\"200\">Nama</th>\n                <th field=\"nama_sinonim\" width=\"200\">Sinonim</th>\n                <th field=\"het\" width=\"100\" align=\"right\" formatter=\"formatMoney\">HET</th>\n                <th field=\"quantity\" width=\"80\" align=\"right\">Qty Stok</th>\n                <th field=\"quantity_order\" width=\"80\" align=\"right\">Qty Booking</th>\n                <th field=\"gudang_nama\" width=\"100\">Gudang</th>\n                <th field=\"rak_nama\" width=\"100\">Lokasi</th>\n                <th field=\"add_action\" width=\"100\" align=\"center\">Action</th>\n            </tr>\n            </thead>\n        </table>\n    </div>\n    <div data-options=\"region:'south',border:false\" style=\"height: 250px; padding: 0px 10px 10px\">\n        <table id=\"list_purchase_order_detail\" style=\"width: 100%;height: 200px\">\n            <thead>\n            <tr>\n                <th field=\"suku_cadang_kode\" width=\"150\">Kode Part</th>\n                <th field=\"suku_cadang_nama\" width=\"250\">Nama</th>\n                <th field=\"quantity_order\" width=\"80\" align=\"center\">Jml Order</th>\n                <th field=\"quantity_supp\" width=\"80\" align=\"center\">Pemenuhan</th>\n                <th field=\"quantity_back_order\" width=\"80\" align=\"center\">Back Order</th>\n                <th field=\"action\" width=\"100\" align=\"center\">#</th>\n            </tr>\n            </thead>\n        </table>\n        <div style=\"padding-top: 10px;\">\n            <button id=\"btn_add\" class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-add'\">Tambah</button>\n            <button id=\"btn_save\" class=\"easyui-linkbutton\" data-options=\"iconCls:'fam disk'\">Simpan</button>\n            <button id=\"btn_send\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-lock'\">Kirim ke Supplier</button>\n            <button id=\"btn_force_close\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-lock'\">Force Close</button>\n            <button id=\"btn_cetak\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-print'\">Cetak Nota</button>\n        </div>\n    </div>\n</div>\n\n<div id=\"dialog_search_supplier\">\n    <table class=\"easyui-datagrid\" id=\"list_supplier\" style=\"height: 100%\">\n        <thead>\n        <tr>\n            <th field=\"kode\" width=\"120\">Kode</th>\n            <th field=\"nama\" width=\"220\">Nama</th>\n            <th field=\"alamat\" width=\"220\">Alamat</th>\n            <th field=\"no_telp\" width=\"120\" align=\"center\">No Telp</th>\n            <th field=\"nama_pic\" width=\"120\" align=\"center\">PIC</th>\n            <th field=\"no_telp_pic\" width=\"120\" align=\"center\">No Telp PIC</th>\n            <th field=\"action\" width=\"120\" align=\"center\">#</th>\n        </tr>\n        </thead>\n    </table>\n</div>\n\n<div id=\"dialog_edit_detail\" style=\"padding: 10px\">\n    <div style=\"margin-bottom:20px\">\n        <input class=\"easyui-textbox\" id=\"suku_cadang_nama\" disabled style=\"width:350px\"\n               data-options=\"label:'Nama Suku Cadang:'\" labelWidth=\"120px\"/>\n    </div>\n    <div style=\"margin-bottom:20px\">\n        <input class=\"easyui-numberbox\" id=\"quantity_order\" style=\"width:200px\" data-options=\"label:'Qty Order:'\"\n               labelWidth=\"120px\"/>\n    </div>\n    <div style=\"margin-bottom:20px\">\n        <input class=\"easyui-numberbox\" id=\"quantity_supp\" style=\"width:200px\" data-options=\"label:'Qty Supply:'\" disabled\n               labelWidth=\"120px\"/>\n    </div>\n    <div style=\"margin-bottom:20px\">\n        <input class=\"easyui-numberbox\" id=\"quantity_back_order\" style=\"width:200px\" disabled\n               data-options=\"label:'Qty Back Order:'\" labelWidth=\"120px\"/>\n    </div>\n    <div style=\"text-align:center;padding:5px 0\">\n        <button id=\"btn_save_detail\" class=\"easyui-linkbutton\" style=\"width:80px\">Simpan</button>\n        <button id=\"btn_cancel_detail\" class=\"easyui-linkbutton\" style=\"width:80px\">Batal</button>\n    </div>\n</div>\n\n<script>\n    //Search Supplier\n    \$(document).off(\"click\", \".btn-supplier-gunakan\");\n    \$(document).on(\"click\", \".btn-supplier-gunakan\", function () {\n        var data_id = \$(this).attr(\"data_id\");\n        //\$(\"#supplier\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("supplier-combo"));
echo "?id=\" + data_id);\n        \$(\"#supplier\").combobox(\"select\", data_id);\n        \$('#dialog_search_supplier').window('close');\n        return false;\n    });\n\n    \$(\"#dialog_search_supplier\").window({\n        width: 800,\n        height: 380,\n        modal: true,\n        closed: true,\n        title: \"Data Supplier (Klik 2x untuk memilih)\"\n    });\n\n    \$(\"#list_supplier\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-supplier"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        //pageSize: 19,\n        toolbar: addSearchToolbar(\"list_supplier\"),\n        onDblClickRow: function(index, row){\n            var data_id = row.id;\n            //\$(\"#supplier\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("supplier-combo"));
echo "?id=\" + data_id);\n            \$(\"#supplier\").combobox(\"select\", data_id);\n            \$('#dialog_search_supplier').window('close');\n        }\n    });\n\n    \$(\"#btn_search_supplier\").linkbutton({\n        onClick: function () {\n            \$('#dialog_search_supplier').window('open');\n            return false;\n        }\n    });\n\n    \$(\"#btn_add\").linkbutton({\n        onClick: function(){\n            \$(\"#kode_order\").textbox(\"setValue\", \"\");\n            \$(\"#no_po\").textbox(\"setValue\", \"\");\n            \$(\"#tanggal_po\").datebox(\"setValue\", \"";
echo date("Y-m-d");
echo "\").datebox(\"enable\");\n            \$(\"#tipe_po\").combobox(\"enable\");\n            //\$(\"#supplier\").combobox(\"enable\");\n            //\$(\"#status_po\").combobox(\"enable\");//.combobox(\"setValue\", \"\");\n            \$(\"#btn_search_supplier\").linkbutton(\"enable\");\n\n            purchase_order = null;\n        }\n    });\n\n    \$(\"#btn_save\").linkbutton({\n        onClick: function(){\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("save-purchase-order"));
echo "\" + (purchase_order==null ? \"\" : \"?id=\" + purchase_order.id),\n                data: {\n                    purchase_order_tipe_id: \$(\"#tipe_po\").combobox('getValue'),\n                    supplier_id: \$(\"#supplier\").combobox('getValue'),\n                    tanggal_po: \$(\"#tanggal_po\").datebox('getValue')\n                },\n                dataType: \"json\",\n                type: \"post\",\n                success: function (data) {\n                    if (data.status != 200) {\n                        dialog(data.message);\n                    } else {\n                        dialog(data.message);\n                        \$('#list_purchase_order').datagrid('reload');\n                    }\n\n                    purchase_order = data.model;\n                    showData();\n                    reloadButtons();\n                    reloadPurchaseOrderDetail();\n                },\n                error: function(xhr, ajaxOptions, thrownError){\n                    dialog(xhr.responseJSON.message);\n                }\n            });\n        }\n    });\n\n    \$(\"#btn_send\").linkbutton({\n        onClick: function(){\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("send-to-supplier"));
echo "?id=\" + purchase_order.id,\n                dataType: \"json\",\n                type: \"post\",\n                success: function (data) {\n                    if (data.status != 200) {\n                        dialog(data.message);\n                    } else {\n                        dialog(data.message);\n                        \$('#list_purchase_order').datagrid('reload');\n                    }\n\n                    purchase_order = data.model;\n                    reloadButtons();\n                },\n                error: function(xhr, ajaxOptions, thrownError){\n                    dialog(xhr.responseJSON.message);\n                }\n            });\n        }\n    });\n\n    \$(\"#btn_force_close\").linkbutton({\n        onClick: function(){\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("force-close"));
echo "?id=\" + purchase_order.id,\n                dataType: \"json\",\n                type: \"post\",\n                success: function (data) {\n                    if (data.status != 200) {\n                        dialog(data.message);\n                    } else {\n                        dialog(data.message);\n                        \$('#list_purchase_order').datagrid('reload');\n                    }\n\n                    purchase_order = data.model;\n                    reloadButtons();\n                },\n                error: function(xhr, ajaxOptions, thrownError){\n                    dialog(xhr.responseJSON.message);\n                }\n            });\n        }\n    });\n\n    var purchase_order = null;\n\n    function showData(){\n        \$(\"#kode_order\").textbox(\"setValue\", purchase_order.kode);\n        \$(\"#no_po\").textbox(\"setValue\", purchase_order.nomor);\n        \$(\"#tanggal_po\").datebox(\"setValue\", purchase_order.tanggal_pembuatan).datebox(\"disable\");\n        \$(\"#tipe_po\").combobox(\"disable\").combobox(\"setValue\", purchase_order.purchase_order_tipe_id);\n        if(purchase_order.purchase_order_status_id == 1){\n            \$(\"#btn_search_supplier\").linkbutton(\"enable\");\n        }else {\n            \$(\"#btn_search_supplier\").linkbutton(\"disable\");\n        }\n        \$(\"#supplier\").combobox(\"setValue\", purchase_order.supplier_id);\n        \$(\"#status_po\").combobox(\"disable\").combobox(\"setValue\", purchase_order.purchase_order_status_id);\n    }\n\n    function reloadButtons(){\n        if(purchase_order == null){\n            \$(\"#btn_send\").linkbutton('disable');\n            \$(\"#btn_cetak\").linkbutton('disable');\n            \$(\"#btn_force_close\").linkbutton('disable');\n        }else {\n            if (purchase_order.purchase_order_status_id == 1) {\n                //Entry\n                \$(\"#btn_send\").linkbutton('enable');\n                \$(\"#btn_cetak\").linkbutton('enable');\n                \$(\"#btn_force_close\").linkbutton('disable');\n            } else if (purchase_order.purchase_order_status_id == 2) {\n                //Sent\n                \$(\"#btn_send\").linkbutton('disable');\n                \$(\"#btn_cetak\").linkbutton('enable');\n                \$(\"#btn_force_close\").linkbutton('enable');\n            } else if (purchase_order.purchase_order_status_id == 3) {\n                //Close\n                \$(\"#btn_send\").linkbutton('disable');\n                \$(\"#btn_cetak\").linkbutton('enable');\n                \$(\"#btn_force_close\").linkbutton('disable');\n            } else if (purchase_order.purchase_order_status_id == 4) {\n                //Cancel\n                \$(\"#btn_send\").linkbutton('disable');\n                \$(\"#btn_cetak\").linkbutton('disable');\n                \$(\"#btn_force_close\").linkbutton('disable');\n            }\n        }\n    }\n\n    function reloadPurchaseOrderDetail() {\n        var url = \"";
echo yii\helpers\Url::to(array("list-purchase-order-detail"));
echo "?id=\" + purchase_order.id;\n        \$('#list_purchase_order_detail').datagrid('load', url);\n    }\n\n    \$(\"#list_purchase_order\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-purchase-order"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        //toolbar: addSearchToolbar('list_purchase_order'),\n        onLoadSuccess: function () {\n            \$(this).datagrid('getPanel').find('a.easyui-linkbutton').linkbutton();\n        },\n        onClickRow: function (index, row) {\n            purchase_order = row;\n\n            showData();\n\n            reloadButtons();\n\n            reloadPurchaseOrderDetail();\n        }\n    });\n\n    \$(\"#list_suku_cadang\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-suku-cadang"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        toolbar: addSearchToolbar('list_suku_cadang')\n    });\n\n    \$(document).off(\"click\", \".btn-sukucadang-add\");\n    \$(document).on(\"click\", \".btn-sukucadang-add\", function () {\n        if (purchase_order == null) {\n            dialog(\"Mohon pilih Purchase Order terlebih dahulu.\");\n            return false;\n        }\n        var data_id = \$(this).attr(\"data_id\");\n        \$.ajax({\n            url: \"";
echo yii\helpers\Url::to(array("add-detail"));
echo "\",\n            data: {\n                purchase_order_id: purchase_order.id,\n                suku_cadang_id: data_id\n            },\n            dataType : \"json\",\n            success: function () {\n                reloadPurchaseOrderDetail();\n            },\n            error: function (xhr, ajaxOptions, thrownError) {\n                dialog(xhr.responseJSON.message);\n            }\n        });\n        return false;\n    });\n\n    \$(\"#list_purchase_order_detail\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-purchase-order-detail"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true\n    });\n\n    var detail = null;\n\n    \$(\"#dialog_edit_detail\").window({\n        width: 400,\n        height: 280,\n        modal: true,\n        closed: true,\n        title: \"Edit Detail\"\n    });\n\n    \$(document).off(\"click\", \".btn-po-detail-edit\");\n    \$(document).on(\"click\", \".btn-po-detail-edit\", function () {\n        detail = {\n            data_id: \$(this).attr(\"data_id\")\n        };\n\n        \$(\"#dialog_edit_detail\").window('open');\n\n        \$(\"#suku_cadang_nama\").textbox(\"setValue\", \$(this).attr(\"suku_cadang_nama\"));\n        \$(\"#quantity_order\").numberbox(\"setValue\", \$(this).attr(\"quantity_order\"));\n        \$(\"#quantity_supp\").numberbox(\"setValue\", \$(this).attr(\"quantity_supp\"));\n        \$(\"#quantity_back_order\").numberbox(\"setValue\", \$(this).attr(\"quantity_back_order\"));\n        return false;\n    });\n\n    \$(document).off(\"click\", \".btn-po-detail-delete\");\n    \$(document).on(\"click\", \".btn-po-detail-delete\", function () {\n        \$.ajax({\n            url: \"";
echo yii\helpers\Url::to(array("delete-detail"));
echo "?id=\" + \$(this).attr(\"data_id\"),\n            dataType: \"json\",\n            success: function () {\n                reloadPurchaseOrderDetail();\n            },\n            error: function (xhr, ajaxOptions, thrownError) {\n                dialog(xhr.responseJSON.message);\n            }\n        });\n    });\n\n    \$(\"#suku_cadang_nama\").textbox();\n    \$(\"#quantity_order\").numberbox();\n    \$(\"#quantity_supp\").numberbox();\n    \$(\"#quantity_back_order\").numberbox();\n\n    \$(\"#btn_save_detail\").linkbutton({\n        onClick: function () {\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("edit-detail"));
echo "?id=\" + detail.data_id,\n                data: {\n                    quantity_order: \$(\"#quantity_order\").numberbox(\"getValue\"),\n                    quantity_supp: \$(\"#quantity_supp\").numberbox(\"getValue\"),\n                    quantity_back_order: \$(\"#quantity_back_order\").numberbox(\"getValue\"),\n                },\n                type: \"post\",\n                success: function () {\n                    \$(\"#dialog_edit_detail\").window('close');\n                    reloadPurchaseOrderDetail();\n                },\n                error: function (xhr, ajaxOptions, thrownError) {\n                    dialog(xhr.responseJSON.message);\n                }\n            });\n        }\n    });\n\n    \$(\"#btn_cancel_detail\").linkbutton({\n        onClick: function () {\n            \$(\"#dialog_edit_detail\").window('close');\n        }\n    });\n\n    \$(document).off(\"click\", \".send-to-supplier\");\n    \$(document).on(\"click\", \".send-to-supplier\", function () {\n        var id = \$(this).attr(\"data_id\");\n        \$.ajax({\n            url: \"";
echo yii\helpers\Url::to(array("send-to-supplier"));
echo "?id=\" + id,\n            dataType : \"json\",\n            success: function () {\n                \$('#list_purchase_order').datagrid('reload');\n            },\n            error: function(xhr, ajaxOptions, thrownError){\n                dialog(xhr.responseJSON.message);\n            }\n        });\n        return false;\n    });\n\n    \$(document).off(\"click\", \".force-close-po\");\n    \$(document).on(\"click\", \".force-close-po\", function () {\n        var id = \$(this).attr(\"data_id\");\n        \$.ajax({\n            url: \"";
echo yii\helpers\Url::to(array("force-close"));
echo "?id=\" + id,\n            dataType : \"json\",\n            success: function () {\n                \$('#list_purchase_order').datagrid('reload');\n            },\n            error: function(xhr, ajaxOptions, thrownError){\n                dialog(xhr.responseJSON.message);\n            }\n        });\n        return false;\n    });\n\n    \$(\"#btn_cetak\").linkbutton({\n        onClick: function () {\n            if(purchase_order == null){\n                dialog(\"Mohon pilih Order terlebih dahulu.\");\n                return;\n            }\n            var url = \"";
echo yii\helpers\Url::to(array("cetak-nota"));
echo "?id=\" + purchase_order.id;\n            window.open(url, \"Laporan\", \"width=800,height=600\");\n        }\n    });\n\n    setTitle(\"Order Suku Cadang\");\n</script>";

?>