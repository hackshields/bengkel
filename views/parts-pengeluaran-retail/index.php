<?php

echo "<div class=\"easyui-layout\" style=\"width:100%;height:100%;\">\n    <div data-options=\"region:'north',border:false\" style=\"height:180px\">\n        <div class=\"easyui-layout\" style=\"width:100%;height:100%;\">\n            <div data-options=\"region:'west',border:false\" style=\"padding: 10px;width:25%;overflow: hidden\">\n                <div class=\"form-control\">\n                    <input id=\"no_nsc\" disabled class=\"easyui-textbox\" label=\"No NSC:\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:100%\">\n                </div>\n                <div class=\"form-control\">\n                    ";
echo yii\helpers\Html::dropDownList("pengeluaran_part_tipe_id", NULL, yii\helpers\ArrayHelper::map(app\models\PengeluaranPartTipe::find()->all(), "id", "nama"), array("class" => "easyui-combobox", "id" => "pengeluaran_part_tipe_id", "label" => "Transaksi:", "labelWidth" => "100px", "style" => "width:100%", "disabled" => true));
echo "                </div>\n                <div class=\"form-control\">\n                    ";
echo yii\helpers\Html::dropDownList("no_referensi", NULL, yii\helpers\ArrayHelper::map(array(), "id", "nomor"), array("class" => "easyui-combobox", "id" => "no_referensi", "label" => "No PKB:", "labelWidth" => "100px", "style" => "width:250px", "disabled" => true));
echo "\n                    <button id=\"btn_search_pkb\" disabled class=\"easyui-linkbutton\"\n                            data-options=\"iconCls:'icon-search'\"></button>\n                </div>\n                <div class=\"form-control\">\n                    ";
echo yii\helpers\Html::dropDownList("sales_id", Yii::$app->user->id, yii\helpers\ArrayHelper::map(app\models\User::getCurrentActive(), "id", "name"), array("class" => "easyui-combobox", "id" => "sales_id", "label" => "Sales:", "labelWidth" => "100px", "style" => "width:100%", "disabled" => true));
echo "                </div>\n                <div class=\"form-control\">\n                    <input id=\"tanggal_jatuh_tempo\" disabled class=\"easyui-datebox\" label=\"Tgl Jatuh Tempo:\"\n                           labelWidth=\"100px\"\n                           style=\"width:100%\" value=\"";
echo date("Y-m-d");
echo "\">\n                </div>\n            </div>\n            <div data-options=\"region:'center',border:false\" style=\"padding: 10px;overflow: hidden\">\n                <div class=\"form-control\">\n                    ";
echo yii\helpers\Html::dropDownList("nopol", Yii::$app->user->id, yii\helpers\ArrayHelper::map(array(), "id", "nopol"), array("class" => "easyui-combobox", "id" => "nopol", "label" => "Nopol:", "labelWidth" => "100px", "style" => "width:250px", "disabled" => true));
echo "\n                    <button id=\"btn_search_konsumen\" disabled class=\"easyui-linkbutton\"\n                            data-options=\"iconCls:'icon-search'\"></button>\n                </div>\n                <div class=\"form-control\">\n                    <input id=\"nama\" disabled class=\"easyui-textbox\" label=\"Nama:\" labelWidth=\"100px\" data-options=\"\"\n                           style=\"width:250px\" value=\"Direct Customer\">\n                    <button id=\"btn_reset_konsumen\" disabled class=\"easyui-linkbutton\"\n                            data-options=\"iconCls:'fam arrow_refresh'\"></button>\n                </div>\n                <div class=\"form-control\">\n                    <input id=\"alamat\" disabled class=\"easyui-textbox\" label=\"Alamat:\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:100%\">\n                </div>\n                <div class=\"form-control\">\n                    <input id=\"kota\" disabled class=\"easyui-textbox\" label=\"Kota:\" labelWidth=\"100px\" data-options=\"\"\n                           style=\"width:100%\">\n                </div>\n                <div class=\"form-control\">\n                    ";
echo yii\helpers\Html::dropDownList("status_nsc_id", NULL, yii\helpers\ArrayHelper::map(app\models\StatusNsc::find()->all(), "id", "nama"), array("class" => "easyui-combobox", "id" => "status_nsc_id", "label" => "Status:", "labelWidth" => "100px", "style" => "width:100%", "disabled" => true));
echo "                </div>\n                <div class=\"form-control\">\n                    <input id=\"catatan\" disabled class=\"easyui-textbox\" label=\"Catatan:\" labelWidth=\"100px\"\n                           style=\"width:100%\">\n                </div>\n            </div>\n            <div data-options=\"region:'east',border:false\" style=\"width:50%;padding: 10px 10px 0px\">\n                <table class=\"easyui-datagrid\" id=\"list_open_pengeluaran_retail\" style=\"height: 170px\">\n                    <thead>\n                    <tr>\n                        <th field=\"no_nsc\" width=\"120\">No NSC</th>\n                        <th field=\"tanggal_pengeluaran_format\" width=\"100\">Tanggal Proses</th>\n                        <th field=\"no_pkb\" width=\"120\">No PKB</th>\n                        <th field=\"konsumen_nama\" width=\"150\">Nama Konsumen</th>\n                    </tr>\n                    </thead>\n                </table>\n            </div>\n        </div>\n    </div>\n    <div data-options=\"region:'center',border:false\">\n        <div class=\"easyui-layout\" style=\"width:100%;height:100%;\">\n            <div data-options=\"region:'center',border:false\" style=\"padding: 10px\">\n                <table class=\"easyui-datagrid\" id=\"list_all_suku_cadang\" style=\"height: 100%;width:100%\">\n                    <thead>\n                    <tr>\n                        <th field=\"kode\" width=\"120\">Kode Part</th>\n                        <th field=\"nama\" width=\"220\">Nama</th>\n                        <th field=\"nama_sinonim\" width=\"220\">Sinonim</th>\n                        <th field=\"harga_jual\" width=\"80\" align=\"right\" formatter=\"formatMoney\">Harga Jual</th>\n                        <th field=\"quantity\" width=\"80\" align=\"right\">Quantity</th>\n                        <th field=\"rak_nama\" width=\"120\" align=\"center\">Lokasi</th>\n                    </tr>\n                    </thead>\n                </table>\n            </div>\n            <div data-options=\"region:'east',border:false\" style=\"width:40%;padding: 10px\">\n                <div class=\"form-control\">\n                    <input id=\"kode_part\" disabled class=\"easyui-textbox\" label=\"Kode Part:\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:100%\">\n                </div>\n                <div class=\"form-control\">\n                    <input id=\"nama_part\" disabled class=\"easyui-textbox\" label=\"Nama:\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:100%\">\n                </div>\n                <div class=\"form-control\">\n                    <input id=\"harga_jual\" disabled class=\"easyui-numberbox\" label=\"Harga Jual:\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:200px\">\n                    <input id=\"diskon_p\" class=\"easyui-numberbox\" label=\"Diskon(%):\" labelWidth=\"100px\"\n                           precision=\"2\" decimalSeparator=\",\" groupSeparator=\".\"\n                           data-options=\"\" style=\"width:200px\">\n                </div>\n                <div class=\"form-control\">\n                    ";
echo yii\helpers\Html::dropDownList("beban_pembayaran_id", NULL, yii\helpers\ArrayHelper::map(app\models\BebanPembayaran::find()->all(), "id", "nama"), array("class" => "easyui-combobox", "id" => "beban_pembayaran_id", "label" => "Pembayaran:", "labelWidth" => "100px", "prompt" => "(Pilih)", "style" => "width:200px"));
echo "                    <input id=\"diskon_r\" class=\"easyui-numberbox\" label=\"Diskon(Rp):\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:200px\">\n                </div>\n                <div class=\"form-control\">\n                    <input id=\"quantity\" class=\"easyui-textbox\" label=\"Qty:\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:200px\">\n                    <input id=\"total\" disabled class=\"easyui-numberbox\" label=\"Total:\" labelWidth=\"100px\"\n                           data-options=\"\" style=\"width:200px\">\n                </div>\n                <div class=\"form-control\" style=\"text-align: center;\">\n                    <button id=\"btn_save_detail\" class=\"easyui-linkbutton\" data-options=\"iconCls:'fam disk'\">Simpan</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div data-options=\"region:'south',border:false\" style=\"height: 200px;padding: 10px\">\n        <div class=\"easyui-layout\" style=\"width:100%;height:100%;\">\n            <div data-options=\"region:'west',border:false\" style=\"width: 80%;overflow: hidden\">\n                <table class=\"easyui-datagrid\" id=\"list_detail_pengeluaran_retail\" style=\"height: 140px\">\n                    <thead>\n                    <tr>\n                        <th field=\"suku_cadang_kode\" width=\"120\">Kode Part</th>\n                        <th field=\"suku_cadang_nama\" width=\"220\">Nama</th>\n                        <th field=\"suku_cadang_nama_sinonim\" width=\"220\">Sinonim</th>\n                        <th field=\"quantity\" width=\"80\" align=\"right\">Qty</th>\n                        <th field=\"diskon_r\" width=\"80\" align=\"right\" formatter=\"formatMoney\">Diskon(Rp)</th>\n                        <th field=\"diskon_p\" width=\"80\" align=\"right\">Diskon(%)</th>\n                        <th field=\"total\" width=\"80\" align=\"right\" formatter=\"formatMoney\">Total</th>\n                        <th field=\"rak_nama\" width=\"80\" align=\"right\">Lokasi</th>\n                        <th field=\"beban_pembayaran_nama\" width=\"120\" align=\"center\">Pembayaran</th>\n                    </tr>\n                    </thead>\n                </table>\n\n                <div style=\"height: 50px;padding: 10px 0px\">\n                    <button id=\"btn_add\" class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-add'\">Tambah</button>\n                    <button id=\"btn_save\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'fam disk'\">Simpan\n                    </button>\n                    <button id=\"btn_delete_item\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-no'\">\n                        Hapus Item\n                    </button>\n                    <!--<button id=\"btn_mark_complete\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-ok'\">Tandai Telah Selesai</button>-->\n                    <button id=\"btn_delete\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'fam cross'\">Batal\n                        NSC\n                    </button>\n                    <button id=\"btn_pembayaran\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'fam money'\">\n                        Pembayaran\n                    </button>\n                    <button id=\"btn_cetak\" disabled class=\"easyui-linkbutton\" data-options=\"iconCls:'icon-print'\">Cetak\n                        Nota\n                    </button>\n                </div>\n            </div>\n            <div data-options=\"region:'east',border:false\" style=\"width: 20%\">\n                <h2 style=\"text-align: right;padding-right: 15px;\">Total Pembayaran</h2>\n                <h1 id=\"total_pembayaran\" style=\"text-align: right;padding-right: 15px;\">\n                    Rp. 0,-\n                </h1>\n            </div>\n        </div>\n    </div>\n</div>\n\n<div id=\"dialog_search_konsumen\">\n    <table class=\"easyui-datagrid\" id=\"list_konsumen\" style=\"height: 100%\">\n        <thead>\n        <tr>\n            <th field=\"nopol\" width=\"120\">NoPol</th>\n            <th field=\"nama_identitas\" width=\"220\">Nama Identitas</th>\n            <th field=\"alamat\" width=\"220\">Alamat</th>\n            <th field=\"no_telepon\" width=\"120\" align=\"center\">No Telp</th>\n            <th field=\"action\" width=\"120\" align=\"center\">#</th>\n        </tr>\n        </thead>\n    </table>\n</div>\n\n<div id=\"dialog_search_pkb\">\n    <table class=\"easyui-datagrid\" id=\"list_pkb\" style=\"height: 100%\">\n        <thead>\n        <tr>\n            <th field=\"nomor\" width=\"120\">No. PKB</th>\n            <th field=\"tanggal_ass\" width=\"150\" align=\"center\">Tanggal</th>\n            <th field=\"konsumen_nama\" width=\"150\">Nama Konsumen</th>\n            <th field=\"konsumen_nopol\" width=\"150\">Nopol</th>\n            <th field=\"catatan\" width=\"220\">Catatan Mekanik</th>\n            <th field=\"action\" width=\"120\" align=\"center\">#</th>\n        </tr>\n        </thead>\n    </table>\n</div>\n\n<div id=\"dialog_pembayaran_nsc\" class=\"easyui-window\" style=\"padding: 10px 20px;\">\n    <form id=\"ff\" method=\"post\">\n        <div style=\"margin-bottom:5px\">\n            <input id=\"dialog_no_nsc\" name=\"dialog_no_nsc\" class=\"easyui-textbox\"\n                   disabled style=\"width:300px\" label='No. NSC :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:5px\">\n            ";
echo yii\helpers\Html::dropDownList("dialog_pengeluaran_part_tipe_id", NULL, yii\helpers\ArrayHelper::map(app\models\PengeluaranPartTipe::find()->all(), "id", "nama"), array("class" => "easyui-combobox", "id" => "dialog_pengeluaran_part_tipe_id", "label" => "Transaksi:", "labelWidth" => "150px", "style" => "width:300px", "prompt" => "-", "disabled" => true));
echo "        </div>\n        <div style=\"margin-bottom:20px\">\n            <input id=\"dialog_total\" name=\"dialog_total\" class=\"easyui-numberbox\"\n                   precision=\"0\" decimalSeparator=\",\" groupSeparator=\".\"\n                   disabled style=\"width:300px;text-align: right;\" label='Total Kas Harus Dibayar :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:5px\">\n            <input id=\"dialog_tunai\" name=\"dialog_tunai\" class=\"easyui-numberbox\"\n                   precision=\"0\" decimalSeparator=\",\" groupSeparator=\".\"\n                   style=\"width:300px;text-align: right;\" label='Tunai :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:20px\">\n            <input id=\"dialog_debit\" name=\"dialog_debit\" class=\"easyui-numberbox\"\n                   precision=\"0\" decimalSeparator=\",\" groupSeparator=\".\"\n                   style=\"width:300px;text-align: right;\" label='Kartu Debit :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:5px\">\n            <input id=\"dialog_terminal\" name=\"dialog_terminal\" class=\"easyui-textbox\"\n                   style=\"width:300px\" label='Terminal :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:5px\">\n            <input id=\"dialog_bank\" name=\"dialog_bank\" class=\"easyui-textbox\"\n                   style=\"width:300px\" label='Bank :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:5px\">\n            <input id=\"dialog_no_kartu\" name=\"dialog_no_kartu\" class=\"easyui-textbox\"\n                   style=\"width:300px\" label='No Kartu :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:5px\">\n            <input id=\"dialog_pemilik\" name=\"dialog_pemilik\" class=\"easyui-textbox\"\n                   style=\"width:300px\" label='Pemilik :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:20px\">\n            <input id=\"dialog_approval_code\" name=\"dialog_approval_code\" class=\"easyui-textbox\"\n                   style=\"width:300px\" label='Approval Code :' labelWidth=\"150px\">\n        </div>\n        <div style=\"margin-bottom:5px\">\n            <input id=\"dialog_kembali\" name=\"dialog_kembali\" class=\"easyui-numberbox\"\n                   precision=\"0\" decimalSeparator=\",\" groupSeparator=\".\"\n                   disabled style=\"width:300px;text-align: right;\" label='Kembali :' labelWidth=\"150px\">\n        </div>\n        <div style=\"text-align: center;margin-top: 20px\">\n            <button id=\"btn_dialog_bayar\" class=\"easyui-linkbutton\" type=\"button\"\n                    data-options=\"iconCls:'fam money'\" style=\"width: 150px\">\n                Bayar\n            </button>\n        </div>\n    </form>\n</div>\n\n<script>\n    \$(\"#dialog_pembayaran_nsc\").window({\n        width: 400,\n        height: 500,\n        modal: true,\n        closed: true,\n        title: \"Pembayaran\"\n    });\n\n    \$.parser.parse(\"#dialog_pembayaran_nsc\");\n\n    //Search PKB\n    \$(document).off(\"click\", \".btn-pkb-gunakan\");\n    \$(document).on(\"click\", \".btn-pkb-gunakan\", function () {\n        var data_id = \$(this).attr(\"data_id\");\n        \$(\"#no_referensi\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopkb-combo"));
echo "?id=\" + data_id);\n        \$(\"#no_referensi\").combobox(\"setValue\", data_id);\n        \$('#dialog_search_pkb').window('close');\n        return false;\n    });\n\n    \$(\"#dialog_search_pkb\").window({\n        width: 800,\n        height: 380,\n        modal: true,\n        closed: true,\n        title: \"Data PKB (Klik 2x untuk memilih)\"\n    });\n\n    \$(\"#list_pkb\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-pkb"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        //pageSize: 19,\n        toolbar: addSearchToolbar(\"list_pkb\"),\n        onDblClickRow: function (index, row) {\n            var data_id = row.id;\n            \$(\"#no_referensi\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopkb-combo"));
echo "?id=\" + data_id);\n            \$(\"#no_referensi\").combobox(\"setValue\", data_id);\n            \$('#dialog_search_pkb').window('close');\n        }\n    });\n\n    \$(\"#btn_search_pkb\").linkbutton({\n        onClick: function () {\n            \$('#dialog_search_pkb').window('open');\n            return false;\n        }\n    });\n\n    //Search Konsumen\n    \$(document).off(\"click\", \".btn-konsumen-gunakan\");\n    \$(document).on(\"click\", \".btn-konsumen-gunakan\", function () {\n        var data_id = \$(this).attr(\"data_id\");\n        \$(\"#nopol\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopol-combo"));
echo "?id=\" + data_id);\n        \$(\"#nopol\").combobox(\"setValue\", data_id);\n        \$.ajax({\n            url: \"";
echo yii\helpers\Url::to(array("info-combo"));
echo "?id=\" + data_id,\n            dataType: \"json\",\n            success: function (msg) {\n                \$(\"#nama\").textbox(\"setValue\", msg.nama_identitas);\n                \$(\"#alamat\").textbox(\"setValue\", msg.alamat);\n                \$(\"#kota\").textbox(\"setValue\", msg.wilayah_kabupaten_nama);\n            },\n            error: function (xhr, ajaxOptions, thrownError) {\n                dialog(xhr.responseJSON.message);\n            }\n        });\n        \$('#dialog_search_konsumen').window('close');\n        return false;\n    });\n\n    \$(\"#dialog_search_konsumen\").window({\n        width: 800,\n        height: 380,\n        modal: true,\n        closed: true,\n        title: \"Data Konsumen\"\n    });\n\n    \$(\"#list_konsumen\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-konsumen"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        //pageSize: 19,\n        toolbar: addSearchToolbar(\"list_konsumen\"),\n        onDblClickRow: function (index, row) {\n            var data_id = row.id;\n            \$(\"#nopol\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopol-combo"));
echo "?id=\" + data_id);\n            \$(\"#nopol\").combobox(\"setValue\", data_id);\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("info-combo"));
echo "?id=\" + data_id,\n                dataType: \"json\",\n                success: function (msg) {\n                    \$(\"#nama\").textbox(\"setValue\", msg.nama_identitas);\n                    \$(\"#alamat\").textbox(\"setValue\", msg.alamat);\n                    \$(\"#kota\").textbox(\"setValue\", msg.wilayah_kabupaten_nama);\n                },\n                error: function (xhr, ajaxOptions, thrownError) {\n                    dialog(xhr.responseJSON.message);\n                }\n            });\n            \$('#dialog_search_konsumen').window('close');\n        }\n    });\n\n    \$(\"#btn_search_konsumen\").linkbutton({\n        onClick: function () {\n            \$('#dialog_search_konsumen').window('open');\n            return false;\n        }\n    });\n\n    function refreshHarga() {\n        \$.ajax({\n            url: \"";
echo yii\helpers\Url::to(array("load"));
echo "?id=\" + pengeluaran.id,\n            dataType: \"json\",\n            success: function (msg) {\n                \$(\"#total_pembayaran\").html(msg.total_formatted);\n            }\n        });\n    }\n\n    var pengeluaran = null;\n\n    \$(\"#list_open_pengeluaran_retail\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-open-pengeluaran-retail"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        onClickRow: function (index, row) {\n            pengeluaran = row;\n\n            console.log(row);\n\n            \$(\"#total_pembayaran\").html(row.total_formatted);\n\n            \$(\"#no_nsc\").textbox('setValue', row.no_nsc);\n            \$(\"#pengeluaran_part_tipe_id\").combobox('select', row.pengeluaran_part_tipe_id).combobox('disable');\n            //load no ref\n            \$(\"#no_referensi\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopkb-combo"));
echo "?id=\" + row.no_referensi);\n            \$(\"#no_referensi\").combobox('select', row.no_referensi).combobox('disable');\n            \$(\"#btn_search_pkb\").linkbutton('disable');\n            \$(\"#sales_id\").combobox('select', row.sales_id).combobox('disable');\n            \$(\"#tanggal_jatuh_tempo\").datebox('setValue', row.tanggal_jatuh_tempo).datebox('disable');\n            \$(\"#nopol\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopol-combo"));
echo "?id=\" + row.konsumen_id);\n            \$(\"#nopol\").combobox('select', row.konsumen_id);\n            \$(\"#nama\").textbox('setValue', row.konsumen_nama).textbox('enable');\n            \$(\"#alamat\").textbox('setValue', row.konsumen_alamat).textbox('enable');\n            \$(\"#kota\").textbox('setValue', row.konsumen_kota).textbox('enable');\n            \$(\"#btn_search_konsumen\").linkbutton('enable');\n            \$(\"#btn_reset_konsumen\").linkbutton('enable');\n            \$(\"#catatan\").textbox('enable').textbox('setValue', row.catatan);\n\n            if(row.status_pembayaran_id == 1 || row.status_pembayaran_id == null) {\n                //belum bayar\n                \$(\"#btn_delete\").linkbutton('enable');\n                \$(\"#btn_pembayaran\").linkbutton('enable');\n                \$(\"#btn_cetak\").linkbutton(\"disable\");\n            }else{\n                \$(\"#btn_delete\").linkbutton('disable');\n                \$(\"#btn_pembayaran\").linkbutton('disable');\n                \$(\"#btn_cetak\").linkbutton(\"enable\");\n            }\n\n            if(row.status_nsc_id == 1){\n                \$(\"#btn_save\").linkbutton(\"enable\");\n            }\n\n            \$(\"#btn_delete_item\").linkbutton(\"disable\");\n            \$(\"#btn_mark_complete\").linkbutton(\"enable\");\n            \$(\"#list_detail_pengeluaran_retail\").datagrid(\"load\", \"";
echo yii\helpers\Url::to(array("list-detail-pengeluaran-retail"));
echo "?id=\" + pengeluaran.id);\n        }\n    });\n\n    \$(\"#pengeluaran_part_tipe_id\").combobox({\n        onChange: function (newVal, oldVal) {\n            if (newVal == \"2\") {\n                \$(\"#no_referensi\").combobox(\"enable\");\n                \$(\"#btn_search_pkb\").linkbutton(\"enable\");\n            } else {\n                \$(\"#no_referensi\").combobox(\"disable\");\n                \$(\"#btn_search_pkb\").linkbutton(\"disable\");\n            }\n        }\n    });\n\n    var suku_cadang = null;\n    \$(\"#list_all_suku_cadang\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-all-suku-cadang"));
echo "\",\n        toolbar: addSearchToolbar(\"list_all_suku_cadang\"),\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        onClickRow: function (index, row) {\n            if (pengeluaran == null) {\n                dialog(\"Silakan pilih pengeluaran\");\n                return;\n            }\n\n            detail = null;\n            suku_cadang = row;\n\n            if(pengeluaran.status_nsc_id == 2){\n                dialog(\"NSC yg Anda pilih sudah dibayar, Anda tidak dapat menambahkan item.\");\n                return;\n            }\n\n            \$(\"#kode_part\").textbox(\"setValue\", row.kode);\n            \$(\"#nama_part\").textbox(\"setValue\", row.nama);\n            \$(\"#harga_jual\").numberbox(\"setValue\", row.harga_jual);\n            \$(\"#beban_pembayaran_id\").combobox(\"setValue\", \"1\");\n            \$(\"#quantity\").numberbox(\"setValue\", \"1\");\n            \$(\"#diskon_p\").numberbox(\"setValue\", \"0\");\n            \$(\"#diskon_r\").numberbox(\"setValue\", \"0\");\n\n            hitungTotal();\n        }\n    });\n\n    \$(\"#quantity\").numberbox({\n        onChange: function (newValue, oldValue) {\n            hitungTotal();\n        }\n    });\n\n    \$(\"#diskon_p\").numberbox({\n        onChange: function (newValue, oldValue) {\n            hitungTotal();\n        }\n    });\n\n    \$(\"#diskon_r\").numberbox({\n        onChange: function (newValue, oldValue) {\n            hitungTotal();\n        }\n    });\n\n    function hitungTotal() {\n        var total = parseInt(\$(\"#harga_jual\").numberbox('getValue')) * parseInt(\$(\"#quantity\").numberbox('getValue'));\n        if (parseFloat(\$(\"#diskon_p\").numberbox('getValue')) != 0) {\n            total -= parseFloat(\$(\"#diskon_p\").numberbox('getValue')) / 100 * total;\n        } else if (parseFloat(\$(\"#diskon_r\").numberbox('getValue')) != 0) {\n            total -= parseFloat(\$(\"#diskon_r\").numberbox('getValue'));\n        }\n        \$(\"#total\").numberbox(\"setValue\", total);\n    }\n\n    var detail = null;\n    \$(\"#list_detail_pengeluaran_retail\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-detail-pengeluaran-retail"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        onClickRow: function (index, row) {\n            \$(\"#btn_delete_item\").linkbutton(\"enable\");\n            detail = row;\n            suku_cadang = null;\n\n            console.log(row);\n\n            \$(\"#kode_part\").textbox(\"setValue\", row.suku_cadang_kode);\n            \$(\"#nama_part\").textbox(\"setValue\", row.suku_cadang_nama);\n            \$(\"#harga_jual\").numberbox(\"setValue\", row.harga_jual);\n            \$(\"#quantity\").numberbox(\"setValue\", row.quantity);\n            \$(\"#diskon_p\").numberbox(\"setValue\", row.diskon_p);\n            \$(\"#diskon_r\").numberbox(\"setValue\", row.diskon_r);\n            \$(\"#beban_pembayaran_id\").combobox(\"select\", row.beban_pembayaran_id);\n\n            hitungTotal();\n        }\n    });\n\n    \$(\"#btn_save_detail\").linkbutton({\n        onClick: function () {\n            if (pengeluaran == null && detail == null) {\n                dialog(\"Silakan pilih NSC terlebih dahulu. Jika belum ada, mohon buat NSC baru.\");\n                return;\n            }\n\n            if (suku_cadang == null && detail == null) {\n                dialog(\"Silakan pilih Suku Cadang terlebih dahulu.\");\n                return;\n            }\n\n            console.log(pengeluaran);\n\n            var suku_cadang_id, pengeluaran_part_id, rak_id, harga_jual, hpp;\n            if(detail != null){\n                suku_cadang_id = detail.suku_cadang_id;\n                pengeluaran_part_id = detail.pengeluaran_part_id;\n                rak_id = detail.rak_id;\n                harga_jual = detail.harga_jual;\n                hpp = detail.hpp;\n            }else{\n                //new record\n                suku_cadang_id = suku_cadang.id;\n                pengeluaran_part_id = pengeluaran.id;\n                rak_id = suku_cadang.rak_id;\n                harga_jual = suku_cadang.harga_jual;\n                hpp = suku_cadang.hpp;\n            }\n\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("save-detail"));
echo "\" + (detail != null ? \"?id=\" + detail.id : \"\"),\n                data: {\n                    suku_cadang_id: suku_cadang_id,\n                    pengeluaran_part_id: pengeluaran_part_id,\n                    rak_id: rak_id,\n                    harga_jual: harga_jual,\n                    hpp: hpp,\n                    quantity: \$(\"#quantity\").numberbox('getValue'),\n                    diskon_p: \$(\"#diskon_p\").numberbox('getValue'),\n                    diskon_r: \$(\"#diskon_r\").numberbox('getValue'),\n                    total: \$(\"#total\").numberbox('getValue'),\n                    beban_pembayaran_id: \$(\"#beban_pembayaran_id\").val()\n                },\n                type: \"post\",\n                dataType: \"json\",\n                success: function (msg) {\n                    dialog(msg.message);\n                    if (msg.status == 200) {\n                        pengeluaran = msg.model;\n                        refreshHarga();\n                        \$(\"#list_detail_pengeluaran_retail\").datagrid(\"load\", \"";
echo yii\helpers\Url::to(array("list-detail-pengeluaran-retail"));
echo "?id=\" + pengeluaran.id);\n                    }\n                    suku_cadang = null;\n                },\n                error: function (xhr, ajaxOptions, thrownError) {\n                    dialog(xhr.responseJSON.message);\n                }\n            });\n\n            return false;\n        }\n    });\n\n    \$(\"#btn_add\").linkbutton({\n        onClick: function () {\n            \$(\"#btn_save\").linkbutton(\"enable\");\n            \$(\"#no_nsc\").textbox('setValue', \"\");\n            \$(\"#pengeluaran_part_tipe_id\").combobox(\"enable\").combobox(\"select\", \"1\");\n            \$(\"#sales_id\").combobox(\"enable\").combobox(\"setValue\", \"\");\n            \$(\"#tanggal_jatuh_tempo\").datebox(\"enable\").datebox(\"setValue\", \"";
echo date("Y-m-d");
echo "\");\n            \$(\"#btn_search_konsumen\").linkbutton(\"enable\");\n            \$(\"#nama\").textbox(\"enable\").textbox(\"setValue\", \"Direct Customer\");\n            \$(\"#alamat\").textbox(\"enable\").textbox(\"setValue\", \"\");\n            \$(\"#kota\").textbox(\"enable\").textbox(\"setValue\", \"\");\n            \$(\"#btn_reset_konsumen\").linkbutton(\"enable\");\n            \$(\"#catatan\").textbox('enable');\n\n            pengeluaran = null;\n\n            return false;\n        }\n    });\n\n    \$(\"#btn_save\").linkbutton({\n        onClick: function () {\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("save-pengeluaran"));
echo "\" + (pengeluaran != null ? \"?id=\" + pengeluaran.id : \"\"),\n                data: {\n                    no_nsc: \$(\"#no_nsc\").val(),\n                    pengeluaran_part_tipe_id: \$(\"#pengeluaran_part_tipe_id\").val(),\n                    no_referensi: \$(\"#no_referensi\").combobox('getValue'),\n                    sales_id: \$(\"#sales_id\").combobox('getValue'),\n                    tanggal_jatuh_tempo: \$(\"#tanggal_jatuh_tempo\").datebox('getValue'),\n                    konsumen_id: \$(\"#nopol\").combobox('getValue'),\n                    konsumen_nama: \$(\"#nama\").textbox('getValue'),\n                    konsumen_alamat: \$(\"#alamat\").textbox('getValue'),\n                    konsumen_kota: \$(\"#kota\").textbox('getValue'),\n                    status_nsc_id: \$(\"#status_nsc_id\").combobox('getValue'),\n                    catatan: \$(\"#catatan\").textbox('getValue')\n                },\n                type: \"post\",\n                dataType: \"json\",\n                success: function (msg) {\n                    dialog(msg.message);\n                    if (msg.status == 200) {\n                        \$(\"#list_open_pengeluaran_retail\").datagrid(\"reload\");\n\n                        pengeluaran = msg.model;\n\n                        \$(\"#total_pembayaran\").html(pengeluaran.total_formatted);\n\n                        \$(\"#no_nsc\").textbox('setValue', pengeluaran.no_nsc).textbox('disable');\n                        \$(\"#pengeluaran_part_tipe_id\").combobox('select', pengeluaran.pengeluaran_part_tipe_id).combobox('disable');\n                        //load no ref\n                        \$(\"#no_referensi\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopkb-combo"));
echo "?id=\" + pengeluaran.no_referensi);\n                        \$(\"#no_referensi\").combobox('select', pengeluaran.no_referensi).combobox('disable');\n                        \$(\"#btn_search_pkb\").linkbutton('disable');\n                        \$(\"#sales_id\").combobox('select', pengeluaran.sales_id).combobox('disable');\n                        \$(\"#tanggal_jatuh_tempo\").datebox('setValue', pengeluaran.tanggal_jatuh_tempo).datebox('disable');\n                        \$(\"#nopol\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("nopol-combo"));
echo "?id=\" + pengeluaran.konsumen_id);\n                        \$(\"#nopol\").combobox('select', pengeluaran.konsumen_id);\n                        \$(\"#nama\").textbox('setValue', pengeluaran.konsumen_nama).textbox('enable');\n                        \$(\"#alamat\").textbox('setValue', pengeluaran.konsumen_alamat).textbox('enable');\n                        \$(\"#kota\").textbox('setValue', pengeluaran.konsumen_kota).textbox('enable');\n                        \$(\"#btn_search_konsumen\").linkbutton('enable');\n                        \$(\"#btn_reset_konsumen\").linkbutton('enable');\n\n                        \$(\"#btn_delete\").linkbutton('enable');\n                        \$(\"#btn_pembayaran\").linkbutton('enable');\n                        \$(\"#btn_cetak\").linkbutton(\"disable\");\n                        \$(\"#btn_delete_item\").linkbutton(\"disable\");\n                        \$(\"#list_detail_pengeluaran_retail\").datagrid(\"load\", \"";
echo yii\helpers\Url::to(array("list-detail-pengeluaran-retail"));
echo "?id=\" + pengeluaran.id);\n\n                        refreshHarga();\n                    }\n                },\n                error: function (xhr, ajaxOptions, thrownError) {\n                    dialog(xhr.responseJSON.message);\n                }\n            });\n\n            return false;\n        }\n    });\n\n    \$(\"#btn_delete_item\").linkbutton({\n        onClick: function () {\n            if(detail == null){\n                dialog(\"Mohon pilih item terlebih dahulu.\");\n                return;\n            }\n            \$(\"#btn_delete_item\").linkbutton('disable');\n            if (confirm(\"Apakah Anda yakin ingin menghapus item ini ?\")) {\n                \$.ajax({\n                    url: \"";
echo yii\helpers\Url::to(array("delete-detail"));
echo "?id=\" + detail.id,\n                    dataType: \"json\",\n                    success: function (msg) {\n                        detail = null;\n                        dialog(msg.message);\n                        \$(\"#list_detail_pengeluaran_retail\").datagrid(\"load\", \"";
echo yii\helpers\Url::to(array("list-detail-pengeluaran-retail"));
echo "?id=\" + pengeluaran.id);\n                    },\n                    error: function (xhr, ajaxOptions, thrownError) {\n                        dialog(xhr.responseJSON.message);\n                    }\n                });\n            }\n        }\n    });\n\n    \$(\"#btn_delete\").linkbutton({\n        onClick: function () {\n\n        }\n    });\n\n    \$(\"#btn_pembayaran\").linkbutton({\n        onClick: function () {\n            \$('#dialog_pembayaran_nsc').window('open');\n            \$(\"#btn_dialog_bayar\").linkbutton(\"enable\");\n\n            //isi konten\n            \$(\"#dialog_no_nsc\").textbox('setValue', pengeluaran.no_nsc);\n            \$(\"#dialog_pengeluaran_part_tipe_id\").combobox('select', pengeluaran.pengeluaran_part_tipe_id);\n            \$(\"#dialog_total\").numberbox('setValue', pengeluaran.total);\n\n            return false;\n        }\n    });\n\n    \$(\"#btn_dialog_bayar\").linkbutton({\n        onClick: function(){\n            \$(\"#btn_dialog_bayar\").linkbutton('disable');\n\n            \$.ajax({\n                url: \"";
echo yii\helpers\Url::to(array("bayar"));
echo "?id=\" + pengeluaran.id,\n                data : {\n                    tunai : \$(\"#dialog_tunai\").numberbox('getValue'),\n                    debit : \$(\"#dialog_debit\").numberbox('getValue'),\n                    terminal : \$(\"#dialog_terminal\").textbox('getValue'),\n                    bank : \$(\"#dialog_bank\").textbox('getValue'),\n                    no_kartu : \$(\"#dialog_no_kartu\").textbox('getValue'),\n                    pemilik : \$(\"#dialog_pemilik\").textbox('getValue'),\n                    approval_code : \$(\"#dialog_approval_code\").textbox('getValue'),\n                },\n                type: \"post\",\n                dataType: \"json\",\n                success: function (msg) {\n                    dialog(\"Pembayaran Berhasil Dilakukan\");\n                    \$(\"#dialog_pembayaran_nsc\").window('close');\n\n                    \$(\"#list_open_pengeluaran_retail\").datagrid('reload');\n\n                    \$(\"#list_detail_pengeluaran_retail\").datagrid(\"load\", \"";
echo yii\helpers\Url::to(array("list-detail-pengeluaran-retail"));
echo "\");\n\n                    \$(\"#btn_delete\").linkbutton('disable');\n                    \$(\"#btn_pembayaran\").linkbutton('disable');\n                    \$(\"#btn_cetak\").linkbutton(\"enable\");\n                }\n            });\n        }\n    });\n\n    \$(\"#btn_cetak\").linkbutton({\n        onClick: function () {\n            if (pengeluaran == null) {\n                dialog(\"Mohon pilih Pengeluaran terlebih dahulu.\");\n                return;\n            }\n            setTimeout(function () {\n                \$(\"#list_open_pengeluaran_retail\").datagrid('reload');\n            }, 2000);\n\n            var url = \"";
echo yii\helpers\Url::to(array("cetak-nota"));
echo "?id=\" + pengeluaran.id;\n            window.open(url, \"Cetak Nota\", \"width=800,height=600\");\n\n            url = \"";
echo yii\helpers\Url::to(array("picking-slip"));
echo "?id=\" + pengeluaran.id;\n            window.open(url, \"Cetak Picking Slip\", \"width=800,height=600\");\n        }\n    });\n\n    \$(\"#btn_reset_konsumen\").linkbutton({\n        onClick: function () {\n            \$(\"#nopol\").combobox('select', \"\");\n            \$(\"#nama\").textbox('setValue', \"Direct Customer\");\n            \$(\"#alamat\").textbox('setValue', \"\");\n            \$(\"#kota\").textbox('setValue', \"\");\n        }\n    });\n\n    function refreshKembalian(){\n        var kembali = (\$(\"#dialog_tunai\").numberbox('getValue') + \$(\"#dialog_debit\").numberbox('getValue')) - \$(\"#dialog_total\").numberbox('getValue');\n        \$(\"#dialog_kembali\").numberbox(\"setValue\", kembali);\n    }\n\n    \$(\"#dialog_tunai\").numberbox({\n        onChange: function(){\n            refreshKembalian();\n        }\n    });\n\n    \$(\"#dialog_debit\").numberbox({\n        onChange: function(){\n            refreshKembalian();\n        }\n    });\n\n    setTitle(\"Pengeluaran Suku Cadang\");\n</script>";

?>