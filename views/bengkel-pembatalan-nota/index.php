<?php

echo "<div class=\"easyui-layout\" style=\"width:100%;height:100%;\">\n    <div data-options=\"region:'north',border:false\" style=\"height:350px;padding: 10px;overflow: hidden\">\n        <form id=\"form_atas\">\n            <div class=\"form-control\">\n                ";
echo yii\helpers\Html::dropDownList("nota_jasa_id", NULL, array(), array("class" => "easyui-combobox", "id" => "nota_jasa_id", "label" => "No. PKB:", "labelWidth" => "150px", "style" => "width:350px", "disabled" => true));
echo "\n                <button id=\"btn_search_nota_jasa\" class=\"easyui-linkbutton\"\n                        data-options=\"iconCls:'icon-search'\"></button>\n            </div>\n            <div class=\"form-control\">\n                <input id=\"alasan\" class=\"easyui-textbox\" label=\"Alasan:\" labelWidth=\"150px\"\n                       data-options=\"\" style=\"width:450px\">\n            </div>\n            <div style=\"margin-left: 150px\">\n                <button id=\"btn_search\" class=\"easyui-linkbutton\" iconCls=\"icon-search\">Cari Data</button>\n                <button id=\"btn_proses_batal\" disabled class=\"easyui-linkbutton\" iconCls=\"icon-remove\">Proses Batal\n                </button>\n            </div>\n        </form>\n        <hr/>\n        <h3>Informasi PKB</h3>\n        <div class=\"easyui-layout\" style=\"width:100%;height:200px;\">\n            <div data-options=\"region:'west',border:false\" style=\"width:50%;overflow: hidden\">\n                <form id=\"form_bawah\">\n                    <div class=\"form-control\">\n                        <input id=\"nomor\" disabled class=\"easyui-textbox\" label=\"No Faktur:\" labelWidth=\"200px\"\n                               data-options=\"\" style=\"width: 350px\">\n                    </div>\n                    <div class=\"form-control\">\n                        <input id=\"tanggal_njb\" disabled class=\"easyui-datebox\" label=\"Tgl Nota:\" labelWidth=\"200px\"\n                               style=\"width: 320px\" value=\"\">\n                    </div>\n                    <div class=\"form-control\">\n                        <input id=\"nama\" disabled class=\"easyui-textbox\" label=\"Nama Konsumen:\" labelWidth=\"200px\"\n                               data-options=\"\" style=\"width:100%\">\n                    </div>\n                    <div class=\"form-control\">\n                        <input id=\"alamat\" disabled class=\"easyui-textbox\" label=\"Alamat:\" labelWidth=\"200px\"\n                               data-options=\"\" style=\"width:100%\">\n                    </div>\n                    <div class=\"form-control\">\n                        <input id=\"kota\" disabled class=\"easyui-textbox\" label=\"Kota:\" labelWidth=\"200px\"\n                               data-options=\"\" style=\"width:400px\">\n                    </div>\n                </form>\n            </div>\n            <div data-options=\"region:'east',border:false\" style=\"width:50%;padding-left: 10px\">\n                <form id=\"form_samping\">\n                    <div class=\"form-control\">\n                        <input id=\"total_pembelian\" disabled class=\"easyui-textbox\" label=\"Total Pembelian:\"\n                               labelWidth=\"200px\"\n                               data-options=\"\" style=\"width:100%\">\n                    </div>\n                </form>\n            </div>\n        </div>\n    </div>\n    <div data-options=\"region:'center',border:false\" style=\"padding: 10px\">\n        <table id=\"list_detail_nota_jasa\" style=\"height: 100%;width: 100%;\">\n            <thead>\n            <tr>\n                <th field=\"jasa_kode\" width=\"80\">Kode Part</th>\n                <th field=\"jasa_nama\" width=\"150\">Nama</th>\n                <th field=\"harga\" width=\"60\" align=\"right\" formatter=\"formatMoney\">Harga</th>\n                <th field=\"diskon_p\" width=\"60\" align=\"right\">Diskon(%)</th>\n                <th field=\"diskon_r\" width=\"60\" align=\"right\">Diskon(Rp)</th>\n                <th field=\"total\" width=\"100\" align=\"right\" formatter=\"formatMoney\">Total</th>\n            </tr>\n            </thead>\n        </table>\n    </div>\n</div>\n\n<div id=\"dialog_search_nota_jasa\">\n    <table class=\"easyui-datagrid\" id=\"list_nota_jasa\" style=\"height: 100%;width:100%\">\n        <thead>\n        <tr>\n            <th field=\"nomor\" width=\"150\">No PKB</th>\n            <th field=\"karyawan_nama\" width=\"150\">Mekanik</th>\n            <th field=\"tanggal_njb\" align=\"center\" width=\"100\">Tanggal</th>\n            <th field=\"total\" width=\"120\" align=\"right\" formatter=\"formatMoney\">Total</th>\n        </tr>\n        </thead>\n    </table>\n</div>\n\n<div id=\"dialog_otorisasi\" class=\"easyui-dialog\">\n    <div style=\"padding: 20px 30px\">\n        <div class=\"form-control\">\n            ";
echo yii\helpers\Html::dropDownList("user_id", NULL, yii\helpers\ArrayHelper::map(app\models\User::getAuthorizedUsers(), "id", "name"), array("class" => "easyui-combobox", "id" => "user_id", "label" => "Kepala/Owner", "labelWidth" => "100px", "style" => "width:300px"));
echo "        </div>\n        <div class=\"form-control\">\n            <input id=\"user_password\" class=\"easyui-passwordbox\" label=\"Password:\" labelWidth=\"100px\"\n                   data-options=\"\" style=\"width:300px\">\n        </div>\n    </div>\n</div>\n\n<script>\n    //Search nota_jasa\n    \$(\"#dialog_search_nota_jasa\").window({\n        width: 800,\n        height: 380,\n        modal: true,\n        closed: true,\n        title: \"Data PKB (Klik 2x untuk memilih)\"\n    });\n\n    \$(\"#list_nota_jasa\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-nota-jasa"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true,\n        //pageSize: 19,\n        toolbar: addSearchToolbar(\"list_nota_jasa\"),\n        onDblClickRow: function (index, row) {\n            var data_id = row.id;\n            \$(\"#nota_jasa_id\").combobox(\"reload\", \"";
echo yii\helpers\Url::to(array("njb-combo"));
echo "?id=\" + data_id);\n            \$(\"#nota_jasa_id\").combobox(\"setValue\", data_id);\n            \$('#dialog_search_nota_jasa').window('close');\n        }\n    });\n\n    \$(\"#btn_search_nota_jasa\").linkbutton({\n        onClick: function () {\n            \$('#dialog_search_nota_jasa').window('open');\n            \$(\"#list_nota_jasa\").datagrid('reload');\n            return false;\n        }\n    });\n\n    \$(\"#btn_search\").click(function () {\n        \$.ajax({\n            url: \"";
echo yii\helpers\Url::to(array("load"));
echo "?id=\" + \$(\"#nota_jasa_id\").combobox(\"getValue\"),\n            dataType: \"json\",\n            success: function (msg) {\n                var data = msg.data;\n                \$(\"#nomor\").textbox(\"setValue\", data.nomor);\n                \$(\"#tanggal_njb\").datebox(\"setValue\", data.tanggal_njb);\n                \$(\"#nama\").textbox(\"setValue\", data.konsumen_nama);\n                \$(\"#alamat\").textbox(\"setValue\", data.konsumen_alamat);\n                \$(\"#kota\").textbox(\"setValue\", data.konsumen_kota);\n                \$(\"#total_pembelian\").textbox(\"setValue\", data.total);\n\n                \$(\"#list_detail_nota_jasa\").datagrid('load', \"";
echo yii\helpers\Url::to(array("list-detail-nota-jasa"));
echo "?id=\" + data.id);\n\n                \$(\"#btn_proses_batal\").linkbutton(\"enable\");\n            },\n            error: function (xhr, ajaxOptions, thrownError) {\n                dialog(xhr.responseJSON.message);\n            }\n        });\n        return false;\n    });\n\n    \$(\"#btn_proses_batal\").click(function () {\n        if (\$(\"#alasan\").textbox(\"getValue\") == \"\") {\n            dialog(\"Mohon isi Alasan.\");\n            return false;\n        }\n\n        \$(\"#dialog_otorisasi\").dialog('open');\n        return false;\n    });\n\n    \$(\"#list_detail_nota_jasa\").datagrid({\n        url: \"";
echo yii\helpers\Url::to(array("list-detail-nota-jasa"));
echo "\",\n        singleSelect: true,\n        pagination: true,\n        rownumbers: true,\n        fitColumns: true\n    });\n\n    \$.parser.parse(\"#dialog_otorisasi\");\n    \$(\"#dialog_otorisasi\").dialog({\n        width: 400,\n        height: 170,\n        modal: true,\n        closed: true,\n        title: \"Otorisasi Kepala Bengkel/Owner\",\n        buttons: [{\n            text: 'Lanjutkan',\n            iconCls: \"fam disk\",\n            handler: function () {\n                \$.ajax({\n                    url: \"";
echo yii\helpers\Url::to(array("proses-batal"));
echo "\",\n                    data: {\n                        id: \$(\"#nota_jasa_id\").combobox(\"getValue\"),\n                        keterangan: \$(\"#alasan\").textbox(\"getValue\"),\n                        user_id: \$(\"#user_id\").combobox(\"getValue\"),\n                        user_password: \$(\"#user_password\").passwordbox(\"getValue\")\n                    },\n                    dataType: \"json\",\n                    success: function (msg) {\n                        dialog(msg.message);\n\n                        \$(\"#form_atas\").form('reset');\n                        \$(\"#form_bawah\").form('reset');\n                        \$(\"#form_samping\").form('reset');\n                    }\n                });\n                \$(\"#dialog_otorisasi\").dialog('close');\n            }\n        }, {\n            text: 'Batal',\n            iconCls: \"icon-cancel\",\n            handler: function () {\n                \$(\"#dialog_otorisasi\").dialog('close');\n            }\n        }]\n    });\n\n    setTitle(\"Retur Pembelian\");\n</script>";

?>