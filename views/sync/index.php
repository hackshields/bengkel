<?php

echo "<div id=\"win\" class=\"easyui-window\" title=\"Sinkronisasi\" style=\"width:500px;height:250px;padding:20px\">\n    <div id=\"p\" class=\"easyui-progressbar\" style=\"width:100%;\"></div>\n    <div style=\"margin:10px 0;\" id=\"inputan\">\n        <label>Serial Number :</label>\n        <input id=\"serial\" class=\"easyui-textbox\" style=\"width:100%\">\n        <div style=\"padding-top: 10px\">\n            <a href=\"#\" class=\"easyui-linkbutton\" id=\"start_btn\"><i class=\"em em-repeat\"></i> Mulai Sinkronisasi</a>\n        </div>\n    </div>\n    <div style=\"margin:10px 0;\" id=\"outputan\">\n\n    </div>\n</div>\n";
$this->registerJs("\n\n\$(\"#start_btn\").click(function(){\n    \$(\"#inputan\").hide();\n    \$(\"#outputan\").show();\n    \$(\"#outputan\").html(\"\");\n    \$(\"#p\").progressbar(\"setValue\", 0);\n    validasiSerialNumber();\n    return false;\n});\n\nwindow.addEventListener(\"popstate\", changeUrl);\n\nfunction changeUrl(e){\n    if(confirm(\"Anda yakin\")){\n        return true;\n    }\n    return false;\n}\n\nfunction addLog(msg){\n    \$(\"#outputan\").html(\$(\"#outputan\").html()+\"<br>\"+msg);\n}\n\nfunction successLog(msg){\n    \$(\"#outputan\").html(\$(\"#outputan\").html()+\"<br><span style=\\\"color:green\\\">\"+msg+\" <i class=\\\"em em---1\\\"></i></span>\");\n}\n\nfunction errorLog(msg){\n    \$(\"#outputan\").html(\$(\"#outputan\").html()+\"<br><span style=\\\"color:red\\\">\"+msg+\" <i class=\\\"em em-disappointed\\\"></i></span>\");\n}\n\nfunction validasiSerialNumber(){\n    addLog(\"Validasi Serial Number...\");\n    \$.ajax({\n        url : \"" . yii\helpers\Url::to(array("validate-serial-number")) . "\",\n        data : {\n            serial : \$(\"#serial\").textbox(\"getValue\")\n        },\n        dataType: \"json\",\n        success: function(msg){\n            if(msg.status == \"OK\"){\n                successLog(\"Validasi Serial Number Sukses.\");\n                \$(\"#p\").progressbar(\"setValue\", 10);\n                getConst();\n            }else{\n                errorLog(\"Validasi Serial Number Gagal.\");\n                \$(\"#inputan\").show();\n                \$(\"#outputan\").hide();\n                alert(\"Serial Number tidak valid\");\n            }\n        }\n    });\n}\n\nfunction getConst(){\n    addLog(\"Sync Konstanta..\");\n    \$.ajax({\n        url : \"" . yii\helpers\Url::to(array("const")) . "\",\n        success: function(){\n            successLog(\"Sync Konstanta Sukses.\");\n            \$(\"#p\").progressbar(\"setValue\", 30);\n            getSukuCadang()\n            //getAccess();\n        },\n        error: function(){\n            errorLog(\"Sync Konstanta Gagal.\");\n            \$(\"#inputan\").show();\n        }\n    });\n}\n\nfunction getSukuCadang(){\n    addLog(\"Sync Suku Cadang..\");\n    \$.ajax({\n        url : \"" . yii\helpers\Url::to(array("suku-cadang")) . "\",\n        success: function(){\n            successLog(\"Sync Suku Cadang Sukses.\");\n            \$(\"#p\").progressbar(\"setValue\", 40);\n            getAccess()\n        },\n        error: function(){\n            errorLog(\"Sync Suku Cadang Gagal.\");\n            \$(\"#inputan\").show();\n        }\n    });\n}\n\nfunction getAccess(){\n    addLog(\"Sync Jaringan dan User..\");\n    \$.ajax({\n        url : \"" . yii\helpers\Url::to(array("access")) . "\",\n        success: function(){\n            successLog(\"Sync Jaringan dan User Sukses.\");\n            \$(\"#p\").progressbar(\"setValue\", 50);\n            getMaster();\n        },\n        error: function(){\n            errorLog(\"Sync Jaringan dan User Gagal.\");\n            \$(\"#inputan\").show();\n        }\n    });\n}\n\nfunction getMaster(){\n    addLog(\"Sync Data Master..\");\n    \$.ajax({\n        url : \"" . yii\helpers\Url::to(array("master")) . "\",\n        success: function(){\n            successLog(\"Sync Data Master Sukses.\");\n            \$(\"#p\").progressbar(\"setValue\", 60);\n            getTransaction();\n        },\n        error: function(){\n            errorLog(\"Sync Data Master Gagal.\");\n            \$(\"#inputan\").show();\n        }\n    });\n}\n\nfunction getTransaction(){\n    addLog(\"Sync Transaction..\");\n    \$.ajax({\n        url : \"" . yii\helpers\Url::to(array("transaction")) . "\",\n        success: function(){\n            successLog(\"Sync Transaction Sukses.\");\n            \$(\"#p\").progressbar(\"setValue\", 95);\n            getTime();\n        },\n        error: function(){\n            errorLog(\"Sync Transaction Gagal.\");\n            \$(\"#inputan\").show();\n        }\n    });\n}\n\nfunction getTime(){\n    addLog(\"Sync Time..\");\n    \$.ajax({\n        url : \"" . yii\helpers\Url::to(array("get-time")) . "\",\n        success: function(){\n            successLog(\"Sync Time Sukses.\");\n            \$(\"#p\").progressbar(\"setValue\", 100);\n            alert(\"Sinkronisasi Sukses.\");\n            window.location = \"" . yii\helpers\Url::to(array("site/login")) . "\"\n        },\n        error: function(){\n            errorLog(\"Sync Time Gagal.\");\n            \$(\"#inputan\").show();\n        }\n    });\n}\n\n");

?>